{
  "swagger" : "2.0",
  "info" : {
    "description" : "手寫但是可以直接拿來Codegen的API",
    "version" : "1.0.0",
    "title" : "Cornsoup API",
    "contact" : {
      "email" : "arthurgau0419@gmail.com"
    },
    "license" : {
      "name" : "Apache 2.0",
      "url" : "http://www.apache.org/licenses/LICENSE-2.0.html"
    }
  },
  "tags" : [ {
    "name" : "User",
    "description" : "使用者認證"
  }, {
    "name" : "Room/Client",
    "description" : "使用者端"
  }, {
    "name" : "Room/Service",
    "description" : "客服端"
  }, {
    "name" : "Note",
    "description" : "備忘錄"
  }, {
    "name" : "Staff",
    "description" : "客服專用"
  } ],
  "consumes" : [ "application/x-www-form-urlencoded", "multipart/form-data" ],
  "produces" : [ "application/json" ],
  "responses" : {
    "400" : {
      "description" : "Another Error",
      "schema" : {
        "$ref" : "#/definitions/CornsoupError"
      }
    }
  },
  "securityDefinitions" : {
    "ApiToken" : {
      "type" : "apiKey",
      "in" : "header",
      "name" : "access_token"
    }
  },
  "security" : [ {
    "ApiToken" : [ ]
  } ],
  "paths" : {
    "/users/{phone_number}" : {
      "get" : {
        "tags" : [ "User" ],
        "summary" : "使用phone_number取得使用者資訊",
        "description" : "使用phone_number取得使用者資訊",
        "parameters" : [ {
          "in" : "path",
          "name" : "phone_number",
          "type" : "string",
          "required" : true
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "object",
              "required" : [ "message", "user_id", "role", "first_name", "last_name" ],
              "properties" : {
                "message" : {
                  "type" : "string"
                },
                "user_id" : {
                  "type" : "integer"
                },
                "role" : {
                  "type" : "string"
                },
                "first_name" : {
                  "type" : "string"
                },
                "last_name" : {
                  "type" : "string"
                }
              }
            }
          }
        }
      }
    },
    "/users/me" : {
      "get" : {
        "tags" : [ "User" ],
        "summary" : "取得使用者資訊",
        "description" : "取得使用者資訊",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "object",
              "required" : [ "message", "user_id", "role", "email" ],
              "properties" : {
                "message" : {
                  "type" : "string"
                },
                "user_id" : {
                  "type" : "integer"
                },
                "email" : {
                  "type" : "string"
                },
                "role" : {
                  "type" : "string",
                  "enum" : [ "user", "staff", "doctor", "admin" ]
                },
                "first_name" : {
                  "type" : "string"
                },
                "last_name" : {
                  "type" : "string"
                },
                "phone_number" : {
                  "type" : "string"
                }
              }
            }
          }
        }
      }
    },
    "/users/login" : {
      "post" : {
        "tags" : [ "User" ],
        "security" : [ ],
        "summary" : "登入",
        "description" : "",
        "parameters" : [ {
          "in" : "formData",
          "name" : "apn_sandbox",
          "type" : "string",
          "enum" : [ "development", "production" ],
          "required" : true
        }, {
          "in" : "formData",
          "name" : "email",
          "type" : "string",
          "format" : "email",
          "required" : true
        }, {
          "in" : "formData",
          "name" : "password",
          "type" : "string",
          "format" : "password",
          "required" : true
        }, {
          "in" : "formData",
          "name" : "device_type",
          "type" : "string",
          "enum" : [ "ios", "android" ],
          "required" : true
        }, {
          "in" : "formData",
          "name" : "device_token",
          "type" : "string",
          "required" : true
        } ],
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/LoginResponse"
            }
          },
          "404" : {
            "description" : "Another Error",
            "schema" : {
              "$ref" : "#/definitions/MessageResponse"
            }
          },
          "401" : {
            "description" : "Error",
            "schema" : {
              "$ref" : "#/definitions/MessageResponse"
            }
          }
        }
      }
    },
    "/users/logout" : {
      "get" : {
        "tags" : [ "User" ],
        "summary" : "登出",
        "description" : "",
        "responses" : {
          "200" : {
            "description" : "OK"
          }
        }
      }
    },
    "/rooms/call_customer_service" : {
      "post" : {
        "tags" : [ "Room/Client" ],
        "summary" : "使用者撥打客服",
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/CallResponse"
            }
          }
        }
      }
    },
    "/rooms/answer" : {
      "post" : {
        "tags" : [ "Room/Service" ],
        "summary" : "接受",
        "description" : "",
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/ServiceAnswerResponse"
            }
          }
        }
      }
    },
    "/rooms/reject" : {
      "post" : {
        "tags" : [ "Room/Service", "Room/Client" ],
        "summary" : "拒絕通話",
        "description" : "",
        "parameters" : [ {
          "in" : "formData",
          "name" : "room_name",
          "type" : "string",
          "required" : true
        } ],
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/MessageResponse"
            }
          }
        }
      }
    },
    "/rooms/hangup" : {
      "post" : {
        "tags" : [ "Room/Service", "Room/Client" ],
        "summary" : "掛斷",
        "description" : "",
        "parameters" : [ {
          "in" : "formData",
          "name" : "room_name",
          "type" : "string",
          "required" : true
        } ],
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/MessageResponse"
            }
          }
        }
      }
    },
    "/rooms/call_logs" : {
      "get" : {
        "deprecated" : true,
        "tags" : [ "Room/Service" ],
        "summary" : "通話紀錄",
        "description" : "",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/CallLogsResponse"
            }
          }
        }
      }
    },
    "/rooms/missed_call" : {
      "get" : {
        "deprecated" : true,
        "tags" : [ "Room/Service" ],
        "summary" : "未接清單",
        "description" : "",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/MissedCallResponse"
            }
          }
        }
      }
    },
    "/rooms/missed_call_doctor" : {
      "get" : {
        "tags" : [ "Room/Service" ],
        "summary" : "二線撥打一線,未接來電列表",
        "description" : "",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/MissedDoctorCall"
              }
            }
          }
        }
      }
    },
    "/rooms/missed_call_staff" : {
      "get" : {
        "tags" : [ "Room/Service" ],
        "summary" : "一線撥打二線,未接來電列表",
        "description" : "",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/MissedStaffCall"
              }
            }
          }
        }
      }
    },
    "/rooms/call" : {
      "get" : {
        "tags" : [ "Room/Service" ],
        "summary" : "通話紀錄（已接、未接都放在一起）",
        "description" : "",
        "parameters" : [ {
          "in" : "query",
          "name" : "page",
          "type" : "integer",
          "description" : "頁數",
          "required" : false
        }, {
          "in" : "query",
          "name" : "qty",
          "type" : "integer",
          "description" : "筆數",
          "required" : false
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "object",
              "properties" : {
                "calls" : {
                  "type" : "array",
                  "items" : {
                    "$ref" : "#/definitions/Call"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rooms/call_back" : {
      "post" : {
        "tags" : [ "Room/Service" ],
        "summary" : "回撥",
        "description" : "",
        "parameters" : [ {
          "in" : "formData",
          "name" : "user_id",
          "type" : "integer",
          "required" : true
        } ],
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/CallResponse"
            }
          }
        }
      }
    },
    "/rooms/invite_staff" : {
      "post" : {
        "tags" : [ "Room/Service" ],
        "summary" : "一二線互相建立通話並邀請",
        "description" : "目前功能為:一線對二線or二線對一線，可對群組or單人，staff_id or group_id擇一輸入",
        "parameters" : [ {
          "in" : "formData",
          "name" : "group_id",
          "type" : "integer",
          "description" : "登入者為一線則邀請二線群組, 登入者為二線則邀請一線群組"
        }, {
          "in" : "formData",
          "name" : "staff_id",
          "type" : "integer",
          "description" : "有輸入客服id 則僅對開客服邀請"
        } ],
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/CallResponse"
            }
          }
        }
      }
    },
    "/rooms/invite_vip" : {
      "post" : {
        "tags" : [ "Room/Service" ],
        "summary" : "一線建立通話並邀請VIP，非回撥",
        "description" : "",
        "parameters" : [ {
          "in" : "formData",
          "name" : "vip_id",
          "type" : "integer",
          "required" : true,
          "description" : "VIP用戶的ID"
        } ],
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/CallResponse"
            }
          }
        }
      }
    },
    "/rooms/invite_doctor" : {
      "post" : {
        "tags" : [ "Room/Service" ],
        "summary" : "一線客服通話狀態下，邀請二線客服",
        "description" : "",
        "parameters" : [ {
          "in" : "formData",
          "name" : "room_name",
          "type" : "string",
          "required" : true
        }, {
          "in" : "formData",
          "name" : "group_id",
          "type" : "integer"
        }, {
          "in" : "formData",
          "name" : "doctor_id",
          "type" : "integer"
        } ],
        "responses" : {
          "201" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/MessageResponse"
            }
          }
        }
      }
    },
    "/rooms/user_answer" : {
      "post" : {
        "tags" : [ "Room/Client" ],
        "summary" : "使用者接聽",
        "description" : "",
        "responses" : {
          "201" : {
            "description" : "OK"
          }
        }
      }
    },
    "/notes/user_grouped" : {
      "get" : {
        "tags" : [ "Note" ],
        "summary" : "顯示每個客戶的最後一則備忘錄列表",
        "description" : "",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/NotesResponse"
            }
          }
        }
      }
    },
    "/notes" : {
      "post" : {
        "tags" : [ "Note" ],
        "summary" : "新增備忘錄",
        "description" : "",
        "parameters" : [ {
          "in" : "formData",
          "name" : "user_id",
          "type" : "integer",
          "required" : true
        }, {
          "in" : "formData",
          "name" : "note",
          "type" : "string",
          "required" : true
        } ],
        "responses" : {
          "201" : {
            "description" : "Created",
            "schema" : {
              "type" : "object",
              "properties" : {
                "message" : {
                  "type" : "string"
                },
                "note" : {
                  "$ref" : "#/definitions/Note"
                }
              }
            }
          }
        }
      },
      "get" : {
        "tags" : [ "Note" ],
        "summary" : "備忘錄列表（善用各種篩選）",
        "description" : "",
        "parameters" : [ {
          "in" : "query",
          "name" : "user",
          "description" : "客戶的id",
          "type" : "integer"
        }, {
          "in" : "query",
          "name" : "search",
          "description" : "搜尋備忘錄內容",
          "type" : "string"
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "$ref" : "#/definitions/NotesResponse"
            }
          }
        }
      }
    },
    "/notes/{id}" : {
      "patch" : {
        "tags" : [ "Note" ],
        "summary" : "更新備忘錄",
        "description" : "",
        "parameters" : [ {
          "in" : "path",
          "name" : "id",
          "type" : "integer",
          "required" : true
        }, {
          "in" : "formData",
          "name" : "note",
          "type" : "string",
          "required" : true
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "object",
              "properties" : {
                "message" : {
                  "type" : "string"
                },
                "note" : {
                  "$ref" : "#/definitions/Note"
                }
              }
            }
          }
        }
      }
    },
    "/staff_info/name" : {
      "get" : {
        "tags" : [ "Staff" ],
        "summary" : "取得客服名稱",
        "responses" : {
          "200" : {
            "description" : "OK"
          }
        }
      }
    },
    "/staff_info/groups_include_staff" : {
      "get" : {
        "tags" : [ "Staff" ],
        "summary" : "取得一線客服群組",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/Group"
              }
            }
          }
        }
      }
    },
    "/staff_info/groups_include_doctor" : {
      "get" : {
        "tags" : [ "Staff" ],
        "summary" : "取得二線客服群組",
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/Group"
              }
            }
          }
        }
      }
    },
    "/staff_info/doctors" : {
      "get" : {
        "tags" : [ "Staff" ],
        "summary" : "取得二線客服人員",
        "parameters" : [ {
          "in" : "query",
          "name" : "group_id",
          "type" : "integer",
          "required" : false
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/AnotherUser"
              }
            }
          }
        }
      }
    },
    "/staff_info/staffs" : {
      "get" : {
        "tags" : [ "Staff" ],
        "summary" : "取得一線客服人員",
        "parameters" : [ {
          "in" : "query",
          "name" : "group_id",
          "type" : "integer",
          "required" : false
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/AnotherUser"
              }
            }
          }
        }
      }
    },
    "/staff_info/users" : {
      "get" : {
        "tags" : [ "Staff" ],
        "summary" : "取得VIP人員列表",
        "parameters" : [ {
          "in" : "query",
          "name" : "group_id",
          "type" : "integer",
          "required" : false
        } ],
        "responses" : {
          "200" : {
            "description" : "OK",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/AnotherUser"
              }
            }
          }
        }
      }
    }
  },
  "definitions" : {
    "MessageResponse" : {
      "type" : "object",
      "required" : [ "message" ],
      "properties" : {
        "message" : {
          "type" : "string",
          "example" : "你好帥"
        }
      }
    },
    "CornsoupError" : {
      "type" : "object",
      "required" : [ "statusCode", "statusMessage" ],
      "properties" : {
        "statusCode" : {
          "type" : "integer",
          "example" : 400
        },
        "statusMessage" : {
          "type" : "string",
          "example" : "長太帥所以錯誤"
        }
      }
    },
    "LoginResponse" : {
      "type" : "object",
      "required" : [ "message", "user_id", "access_token", "account", "role" ],
      "properties" : {
        "message" : {
          "type" : "string"
        },
        "user_id" : {
          "type" : "integer",
          "example" : 1
        },
        "access_token" : {
          "type" : "string",
          "example" : "AKLx3eE6u9ASsJC9wecd"
        },
        "account" : {
          "type" : "string",
          "example" : "user1@cornsoup.com"
        },
        "first_name" : {
          "type" : "string",
          "example" : "1234"
        },
        "last_name" : {
          "type" : "string",
          "example" : "5678"
        },
        "phone_number" : {
          "type" : "string",
          "example" : "123454"
        },
        "role" : {
          "type" : "string",
          "enum" : [ "user", "staff", "doctor", "admin" ]
        }
      }
    },
    "CallResponse" : {
      "type" : "object",
      "properties" : {
        "target_phone_number" : {
          "type" : "string"
        },
        "api_key" : {
          "type" : "string"
        },
        "room" : {
          "$ref" : "#/definitions/Room"
        }
      }
    },
    "Room" : {
      "type" : "object",
      "properties" : {
        "id" : {
          "type" : "integer"
        },
        "ip" : {
          "type" : "string"
        },
        "name" : {
          "type" : "string"
        },
        "tokbox_token" : {
          "type" : "string"
        },
        "tokbox_session" : {
          "type" : "string"
        },
        "created_at" : {
          "type" : "string"
        },
        "updated_at" : {
          "type" : "string"
        },
        "device_token" : {
          "type" : "string"
        },
        "device_type" : {
          "type" : "string"
        },
        "room_type" : {
          "type" : "string"
        },
        "room_display_name" : {
          "type" : "string"
        },
        "room_member_count" : {
          "type" : "integer"
        },
        "member_phone_numbers" : {
          "type" : "string"
        },
        "unread_qty" : {
          "type" : "integer"
        },
        "read_at" : {
          "type" : "string"
        }
      }
    },
    "ServiceAnswerResponse" : {
      "type" : "object",
      "properties" : {
        "message" : {
          "type" : "string"
        },
        "room_name" : {
          "type" : "string"
        },
        "user_id" : {
          "type" : "integer"
        }
      }
    },
    "MissedCallResponse" : {
      "type" : "object",
      "properties" : {
        "syscode" : {
          "type" : "integer"
        },
        "sysmsg" : {
          "type" : "string"
        },
        "missed_call" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/definitions/MissedCall"
          }
        }
      }
    },
    "CallLogsResponse" : {
      "type" : "object",
      "required" : [ "syscode", "sysmsg", "call_logs" ],
      "properties" : {
        "syscode" : {
          "type" : "integer"
        },
        "sysmsg" : {
          "type" : "string"
        },
        "call_logs" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/definitions/CallLog"
          }
        }
      }
    },
    "CallLog" : {
      "type" : "object",
      "required" : [ "room_id", "user_id", "name", "start_time", "talk_time" ],
      "properties" : {
        "room_id" : {
          "type" : "integer"
        },
        "user_id" : {
          "type" : "integer"
        },
        "name" : {
          "type" : "string"
        },
        "start_time" : {
          "type" : "string",
          "format" : "date-time"
        },
        "talk_time" : {
          "type" : "string"
        }
      }
    },
    "Call" : {
      "type" : "object",
      "required" : [ "room_id", "user_id", "name", "start_time", "talk_time", "user", "missed" ],
      "properties" : {
        "room_id" : {
          "type" : "integer"
        },
        "user_id" : {
          "type" : "integer"
        },
        "name" : {
          "type" : "string"
        },
        "start_time" : {
          "type" : "string",
          "format" : "date-time"
        },
        "talk_time" : {
          "type" : "string"
        },
        "user" : {
          "$ref" : "#/definitions/User"
        },
        "missed" : {
          "type" : "boolean"
        }
      }
    },
    "MissedCall" : {
      "type" : "object",
      "required" : [ "room_id", "user_id", "user_name", "times", "created_at" ],
      "properties" : {
        "room_id" : {
          "type" : "integer"
        },
        "user_id" : {
          "type" : "integer"
        },
        "user_name" : {
          "type" : "string"
        },
        "times" : {
          "type" : "integer"
        },
        "created_at" : {
          "type" : "string",
          "format" : "date-time"
        }
      }
    },
    "MissedDoctorCall" : {
      "type" : "object",
      "required" : [ "room_id", "doctor_id", "doctor_name", "times", "call_type", "created_at" ],
      "properties" : {
        "room_id" : {
          "type" : "integer"
        },
        "doctor_id" : {
          "type" : "integer"
        },
        "doctor_name" : {
          "type" : "string"
        },
        "times" : {
          "type" : "integer"
        },
        "call_type" : {
          "type" : "string"
        },
        "created_at" : {
          "type" : "string",
          "format" : "date-time"
        }
      }
    },
    "MissedStaffCall" : {
      "type" : "object",
      "required" : [ "room_id", "staff_id", "call_type", "created_at" ],
      "properties" : {
        "room_id" : {
          "type" : "integer"
        },
        "staff_id" : {
          "type" : "integer"
        },
        "call_type" : {
          "type" : "string"
        },
        "created_at" : {
          "type" : "string",
          "format" : "date-time"
        }
      }
    },
    "Group" : {
      "type" : "object",
      "required" : [ "group_id", "name" ],
      "properties" : {
        "group_id" : {
          "type" : "integer",
          "example" : "1"
        },
        "name" : {
          "type" : "string",
          "example" : "醫生"
        }
      }
    },
    "User" : {
      "type" : "object",
      "required" : [ "id" ],
      "properties" : {
        "id" : {
          "type" : "integer",
          "example" : 1
        },
        "first_name" : {
          "type" : "string",
          "example" : "小春"
        },
        "last_name" : {
          "type" : "string",
          "example" : "陳"
        },
        "role" : {
          "type" : "string",
          "enum" : [ "user", "staff", "doctor", "admin" ]
        }
      }
    },
    "AnotherUser" : {
      "type" : "object",
      "required" : [ "id", "name", "phone_number" ],
      "properties" : {
        "user_id" : {
          "type" : "integer",
          "example" : 1
        },
        "name" : {
          "type" : "string",
          "example" : "陳小春"
        },
        "phone_number" : {
          "type" : "string",
          "example" : "0912345678"
        }
      }
    },
    "NotesResponse" : {
      "type" : "object",
      "required" : [ "message", "notes" ],
      "properties" : {
        "message" : {
          "type" : "string"
        },
        "notes" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/definitions/Note"
          }
        }
      }
    },
    "Note" : {
      "type" : "object",
      "required" : [ "id", "staff_id", "user_id", "user", "note", "created_at" ],
      "properties" : {
        "id" : {
          "type" : "integer",
          "example" : "1"
        },
        "staff_id" : {
          "type" : "integer",
          "example" : 1
        },
        "user_id" : {
          "type" : "integer",
          "example" : 2
        },
        "user" : {
          "$ref" : "#/definitions/User"
        },
        "note" : {
          "type" : "string",
          "example" : "醫師表示陳小春已經沒救了，家屬趕緊準備辦理後事吧"
        },
        "created_at" : {
          "type" : "string",
          "format" : "date-time",
          "example" : "2017-07-21T17:32:28Z"
        }
      }
    }
  },
  "host" : "cornsoups-dev.herokuapp.com",
  "basePath" : "/api/v1",
  "schemes" : [ "http" ]
}